@using GroupAssignment2.Code;
@page "/flights"

<!-- center -->
<h3>Flight Finder</h3>
<form id="flight_finder_form">
	<!-- selectors -->
	<label for="from">From:</label>
	<select id="from" name="from" @bind="from">
		<option value="" selected>Any</option>
		@foreach (var ad in airportData)
		{
			<option value="@ad.airportCode">@ad.airportFull (@ad.airportCode)</option>
		}
	</select>

	<label for="to">To:</label>
	<select id="to" name="to" @bind="to">
		<option value="" selected>Any</option>
		@foreach (var ad in airportData)
		{
			<option value="@ad.airportCode">@ad.airportFull (@ad.airportCode)</option>
		}
	</select>

	<label for="day">Day:</label>
	<select id="day" name="day" @bind="day">
		<option value="" selected>Any</option>
		@foreach (var d in daysOfWeek)
		{
			<option value="@d">@d</option>
		}
	</select>
</form>
<button @onclick="findFlights">Find Flights</button>

<h3>Flights</h3>
<form id="flights_form">
	<select id="flights" name="flights" @onchange="SelectFlight">
		@if (flightData != null)
		{
			<option value="" selected>Found @flightData.Count() Flight(s):</option>

			@foreach (var fd in flightData)
			{
				<option value="@fd.flightCode">
					@fd.flightCode: @fd.flightName,
					@fd.fromAirportCode -> @fd.toAirportCode,
					@fd.flightDayOfWeek @@ @fd.flightTime,
					@fd.seatsAvailable,
					$@fd.flightCost
				</option>
			}
		}
		else {
			<option value="" selected>Loading...</option>
		}
	</select>
</form>

<h3>Reserve</h3>
<form id="reserve_form">
	<label for="flight_code">Flight code:</label>
	<input type="text" id="flight_code" name="flight_code" @bind="reserveFlightCode" placeholder="Flight" readonly />
	<br />

	<label for="airline">Airline:</label>
	<input type="text" id="airline" name="airline" @bind="reserveFlightAirline" placeholder="Airline" readonly />
	<br />

	<label for="day">Day:</label>
	<input type="text" id="day" name="day" @bind="reserveFlightDay" placeholder="Day" readonly />
	<br />

	<label for="time">Time:</label>
	<input type="text" id="time" name="time" @bind="reserveFlightTime" placeholder="Time" readonly />
	<br />

	<label for="cost">Cost:</label>
	<input type="number" id="cost" name="cost" @bind="reserveFlightCost" placeholder="0" readonly />
	<br />

	<label for="name">Name:</label>
	<input type="text" id="name" name="name" placeholder="Name" />
	<br />

	<label for="citizenship">Citizenship:</label>
	<input type="text" id="citizenship" name="citizenship" placeholder="Citizenship" />
	<br />

	<button type="submit">Reserve</button>
</form>
<p id="reservation_code">Reservation Code:</p>


@code {
	private string from = "";
	private string to = "";
	private string day = "";

	private string flight = "";
	private List<Flight>? flightData;

	AirportClass ac = new AirportClass();
	List<Airport> airportData = AirportClass.GetData();


	List<string> daysOfWeek = new List<string>
	{
		"Sunday",
		"Monday",
		"Tuesday",
		"Wednesday",
		"Thursday",
		"Friday",
		"Saturday"
	};


	private void findFlights()
	{
		FlightClass fc = new FlightClass(from, to, day);
		flightData = FlightClass.GetData();
	}


	private Flight SelectedFlight;
	private string? reserveFlightCode;
	private string? reserveFlightAirline;
	private string? reserveFlightDay;
	private string? reserveFlightTime;
	private string? reserveFlightCost;
	private void SelectFlight(ChangeEventArgs selectedFlight)
	{
		flight = selectedFlight.Value.ToString();

		if (!string.IsNullOrEmpty(flight))
		{
			SelectedFlight = flightData.FirstOrDefault(f => f.flightCode == flight);
		}

		if (SelectedFlight != null)
		{
			reserveFlightCode = SelectedFlight.flightCode;
			reserveFlightAirline = SelectedFlight.flightName;
			reserveFlightDay = SelectedFlight.flightDayOfWeek;
			reserveFlightTime = SelectedFlight.flightTime;
			reserveFlightCost = SelectedFlight.flightCost.ToString();
		}
	}
}